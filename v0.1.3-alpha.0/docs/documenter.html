<html>
<head>
<title>documenter</title>
<style>
body{
    margin: 0 auto;
    font-family: Georgia, Palatino, serif;
    color: #444444;
    line-height: 1;
    max-width: 960px;
    padding: 30px;
}
h1, h2, h3, h4 {
    color: #111111;
    font-weight: 400;
}
h1, h2, h3, h4, h5, p {
    margin-bottom: 24px;
    padding: 0;
}
h1 {
    font-size: 48px;
}
h2 {
    font-size: 36px;
    /* The bottom margin is small. It's designed to be used with gray meta text
     * below a post title. */
    margin: 24px 0 6px;
}
h3 {
    font-size: 24px;
}
h4 {
    font-size: 21px;
}
h5 {
    font-size: 18px;
}
a {
    color: #0099ff;
    margin: 0;
    padding: 0;
    vertical-align: baseline;
}
a:hover {
    text-decoration: none;
    color: #ff6600;
}
a:visited {
    color: purple;
}
ul, ol {
    padding: 0;
    margin: 0;
}
li {
    line-height: 24px;
}
li ul, li ul {
    margin-left: 24px;
}
p, ul, ol {
    font-size: 16px;
    line-height: 24px;
    max-width: 540px;
}
pre {
    padding: 0px 24px;
    max-width: 800px;
    white-space: pre-wrap;
}
code {
    font-family: Consolas, Monaco, Andale Mono, monospace;
    line-height: 1.5;
    font-size: 13px;
}
aside {
    display: block;
    float: right;
    width: 390px;
}
blockquote {
    border-left:.5em solid #eee;
    padding: 0 2em;
    margin-left:0;
    max-width: 476px;
}
blockquote  cite {
    font-size:14px;
    line-height:20px;
    color:#bfbfbf;
}
blockquote cite:before {
    content: '\2014 \00A0';
}

blockquote p {  
    color: #666;
    max-width: 460px;
}
hr {
    width: 540px;
    text-align: left;
    margin: 0 auto 0 0;
    color: #999;
}
</style>
</head>
<body>
<h1>
<a name="documenter" class="anchor" href="#documenter"><span class="octicon octicon-link"></span></a>Documenter</h1>

<p>This is a stopgap documenter until we get a nicer one.</p>

<p>It documents Markdown files using a Github API compatible markdown service.</p>

<p>The content of our stylesheet for rendering inline.</p>

<pre><code>style = require "./style/markdown"
</code></pre>

<p>Export a constructor that when given a markdown service returns a documenter.</p>

<pre><code>module.exports = (markdownService) -&gt;
  documenter =
</code></pre>

<p>Returns a promise that will be fulfilled with html when the markdown source is 
converted.</p>

<pre><code>    document: (source) -&gt;
      markdownService(source)
</code></pre>

<p>Document all source files in a package.</p>

<pre><code>    documentAll: (pkg) -&gt;
      {entryPoint, source, repository} = pkg
      {branch, default_branch} = repository

      if branch is default_branch
        base = "docs"
      else
        base = "#{branch}/docs"

      documentableFiles = Object.keys(source).select (name) -&gt;
        name.extension() is "md"

      promises = documentableFiles.map (name) -&gt;
        documenter.document source[name].content

      Deferred.when(promises).then (results) -&gt;
        index = []

        results.map (result, i) -&gt;
          # Assuming .*.md so we should strip the extension twice
          name = documentableFiles[i].withoutExtension().withoutExtension()

          content = documenter.template name, result.first()

          # Add an index.html if our file is the entry point
          if name is entryPoint
            index.push
              path: "#{base}/index.html"
              content: content

          path: "#{base}/#{name}.html"
          content: content
        .concat(index)
</code></pre>

<p>A super simple template with inline CSS.</p>

<pre><code>    template: (title, html) -&gt;
      """
        &lt;html&gt;
        &lt;head&gt;
        &lt;title&gt;#{title}&lt;/title&gt;
        &lt;style&gt;
        #{style}
        &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
        #{html}
        &lt;/body&gt;
        &lt;/html&gt;
      """
</code></pre>
</body>
</html>